# 用户批量管理功能说明

## 功能概述

为用户管理页面新增了批量操作功能，支持批量删除、批量团队归属变更、批量状态调整等操作，提高管理效率。

## 新增功能

### 1. 批量删除用户
- **功能描述**: 支持同时删除多个用户
- **权限要求**: 仅管理员可操作
- **安全机制**: 
  - 不能删除自己
  - 有关联客户的用户无法删除
  - 删除前需要确认
- **操作结果**: 显示成功/失败统计和详细失败原因

### 2. 批量更新团队归属
- **功能描述**: 支持将多个用户批量转移到指定团队
- **权限要求**: 仅管理员可操作
- **功能特点**:
  - 支持转移到新团队或移除团队归属
  - 自动更新团队成员数量
  - 显示操作结果统计
- **操作流程**: 选择用户 → 点击批量操作 → 选择目标团队 → 确认执行

### 3. 批量状态调整
- **功能描述**: 支持批量启用或停用用户账号
- **权限要求**: 仅管理员可操作
- **状态选项**:
  - 批量启用 (active)
  - 批量停用 (inactive)
- **操作结果**: 显示成功/失败统计

## 技术实现

### 后端API接口

#### 1. 批量删除用户
```
POST /api/users/batch-delete
Body: { userIds: number[] }
```

#### 2. 批量更新团队
```
POST /api/users/batch-update-team
Body: { userIds: number[], teamId: number | null }
```

#### 3. 批量更新状态
```
POST /api/users/batch-update-status
Body: { userIds: number[], status: 'active' | 'inactive' }
```

### 前端功能

#### 1. 用户选择
- 表格支持多选（复选框）
- 不能选择当前登录用户
- 显示已选择用户数量

#### 2. 批量操作菜单
- 下拉菜单形式展示所有批量操作
- 仅在选择用户后显示
- 图标化操作选项

#### 3. 操作确认
- 删除操作需要二次确认
- 状态更新需要确认
- 团队更新通过模态框选择目标团队

#### 4. 结果反馈
- 成功操作显示成功消息
- 部分失败显示详细结果统计
- 失败原因详细展示

## 使用说明

### 操作步骤

1. **登录管理员账号**
   - 使用管理员权限账号登录系统
   - 进入用户管理页面

2. **选择目标用户**
   - 在用户列表中勾选需要操作的用户
   - 可以使用筛选功能缩小范围
   - 系统会显示已选择的用户数量

3. **执行批量操作**
   - 点击"批量操作"按钮
   - 从下拉菜单中选择具体操作
   - 根据提示完成操作确认

4. **查看操作结果**
   - 系统会显示操作结果统计
   - 如有失败项目，会显示详细失败原因
   - 操作完成后自动刷新用户列表

### 注意事项

1. **权限限制**
   - 只有管理员可以执行批量操作
   - 不能对自己执行删除等危险操作

2. **数据安全**
   - 有关联客户的用户无法删除
   - 删除操作不可逆，请谨慎操作
   - 建议先备份重要数据

3. **操作建议**
   - 大批量操作建议分批进行
   - 操作前确认选择的用户正确
   - 关注操作结果反馈

## 测试验证

### 测试用例

1. **批量删除测试**
   - ✅ 删除无关联客户的用户
   - ✅ 拒绝删除有关联客户的用户
   - ✅ 显示详细失败原因

2. **批量团队更新测试**
   - ✅ 成功更新用户团队归属
   - ✅ 自动更新团队成员数量
   - ✅ 支持移除团队归属

3. **批量状态更新测试**
   - ✅ 成功批量启用用户
   - ✅ 成功批量停用用户
   - ✅ 显示操作结果统计

### 测试脚本

项目根目录下的 `test-batch-operations.js` 提供了完整的API测试，可以验证所有批量操作功能。

```bash
node test-batch-operations.js
```

## 系统状态

- ✅ 后端API开发完成
- ✅ 前端界面开发完成
- ✅ 功能测试通过
- ✅ 权限控制正常
- ✅ 错误处理完善

## 访问地址

- 前端地址: http://localhost:3000
- 后端API: http://localhost:3001/api
- 管理员账号: 13800000000 / admin123

用户批量管理功能已完全集成到系统中，可以正常使用。 