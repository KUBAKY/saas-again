# 电话销售管理系统 Web 应用建设需求分析

## 一、项目背景与目标

本系统旨在为电话销售公司提供一套高效、规范、可追溯的客户信息与销售跟进管理平台。通过角色分级、权限分明的管理体系，实现客户数据的全流程管理、销售团队的高效协作、客户跟进的实时追踪与统计分析，提升销售业绩与管理水平。

---

## 二、系统用户与角色权限

### 1. 总经理（Manager）
- 最高权限，拥有全局管理能力。
- 主要功能：
  - 人事管理（小组、组长、销售员的增删改查）
  - 客户数据的全局增删改查
  - 客户归属的批量/单个转移
  - 查看各小组、销售员的客户跟进统计
  - 客户数据批量导入导出

### 2. 小组组长（Leader）
- 组内管理权限。
- 主要功能：
  - 查看、跟进本组所有客户数据
  - 增加客户到本组
  - 客户归属在组内销售员间转移
  - 查看本组销售员的客户跟进统计

### 3. 销售员（Sales）
- 个人客户管理权限。
- 主要功能：
  - 查看、跟进、增加自己的客户数据
  - 给客户添加跟进记录
  - 查看客户详细信息及历史跟进

---

## 三、核心数据结构设计

### 1. 用户表（users）
```
- id: 主键
- phone: 手机号（登录账号，唯一）
- password: 密码（加密存储）
- name: 姓名
- role: 角色（manager/leader/sales）
- team_id: 所属小组ID（外键）
- join_date: 入职时间
- status: 状态（active/inactive）
- created_at: 创建时间
- updated_at: 更新时间
```

### 2. 小组表（teams）
```
- id: 主键
- name: 小组名称
- level: 小组等级（4/10/15/30）
- leader_id: 组长ID（外键）
- member_count: 当前成员数量
- max_members: 最大成员数量
- created_at: 创建时间
- updated_at: 更新时间
```

### 3. 客户表（customers）
```
- id: 主键
- star_level: 价值星级（1-5）
- name: 客户姓名
- phone: 客户电话
- gender: 性别（male/female）
- age: 年龄
- qualification: 客户资质
- owner_id: 归属销售员ID（外键）
- team_id: 归属小组ID（外键）
- created_at: 创建时间
- updated_at: 更新时间
```

### 4. 跟进记录表（follow_records）
```
- id: 主键
- customer_id: 客户ID（外键）
- sales_id: 跟进销售员ID（外键）
- content: 跟进内容
- follow_time: 跟进时间
- created_at: 记录创建时间
```

### 5. 操作日志表（operation_logs）
```
- id: 主键
- user_id: 操作用户ID
- action: 操作类型
- target_type: 目标类型（customer/user/team）
- target_id: 目标ID
- details: 操作详情
- created_at: 操作时间
```

---

## 四、核心业务流程与功能需求

### 1. 用户与团队管理
- **登录认证**：以手机号为唯一登录账号，密码由管理员设置
- **小组管理**：
  - 创建小组：设置名称、等级（4/10/15/30人组）
  - 分配组长：从现有用户中选择或新建
  - 成员管理：添加/移除销售员，限制数量不超过小组等级
- **人员管理**：
  - 添加用户：姓名、手机号、角色、所属小组、入职时间
  - 编辑用户：修改基本信息、重置密码、转移小组
  - 删除用户：软删除，保留历史数据

### 2. 客户信息管理
- **客户信息字段**：
  - 价值星级（1-5星，必填）
  - 姓名（必填）
  - 电话（必填，唯一性校验）
  - 性别（男/女）
  - 年龄（数字）
  - 客户资质（文本）
- **客户操作**：
  - 新增客户：销售员可添加到自己名下
  - 查看客户：根据权限查看对应范围客户
  - 编辑客户：修改基本信息
  - 删除客户：软删除，保留历史记录
  - 转移客户：单个/批量转移归属

### 3. 跟进记录管理
- **跟进记录字段**：
  - 跟进内容（必填，文本框）
  - 跟进时间（可选择日期时间，默认当前时间）
  - 跟进销售员（自动记录当前登录用户）
- **跟进操作**：
  - 添加跟进：在客户详情页添加新的跟进记录
  - 查看历史：按时间倒序显示所有跟进记录
  - 跟进统计：按日期统计跟进人次

### 4. 客户跟进状态提示系统
- **状态色块规则**：
  - 当天有跟进记录：绿色系，跟进次数越多（1-5次）颜色越深
    - 1次：浅绿色 (#e6f7ff)
    - 2次：淡绿色 (#b7eb8f)
    - 3次：中绿色 (#73d13d)
    - 4次：深绿色 (#52c41a)
    - 5次及以上：最深绿色 (#389e0d)
  - 当天无跟进记录：红色 (#ff4d4f)
- **实时更新**：添加跟进记录后立即更新状态色块

### 5. 数据统计与报表
- **统计维度**：
  - 按日期统计（默认当天）
  - 按小组统计跟进人次
  - 按销售员统计跟进人次
- **统计指标**：
  - 跟进客户总人次
  - 跟进记录总条数
  - 活跃销售员数量
- **报表导出**：支持Excel/CSV格式导出

### 6. 安全与权限控制
- **权限矩阵**：
  - Manager：全局增删改查权限
  - Leader：本组增删改查权限
  - Sales：个人增删改查权限
- **数据隔离**：严格按角色权限过滤数据
- **操作审计**：记录所有关键操作日志

---

## 五、主要页面与交互设计

### 1. 登录页面
- **布局**：居中卡片式设计
- **字段**：手机号输入框、密码输入框、登录按钮
- **验证**：前端表单验证 + 后端身份验证
- **跳转**：根据角色跳转到对应后台

### 2. Manager 管理后台
#### 2.1 人事管理页面
- **小组管理**：
  - 小组列表：显示小组名称、等级、组长、成员数量
  - 新建小组：弹窗表单，设置名称、等级、选择组长
  - 编辑小组：修改基本信息、更换组长
  - 删除小组：确认后删除（需先转移成员）
- **人员管理**：
  - 人员列表：显示姓名、手机号、角色、小组、入职时间
  - 新增人员：弹窗表单，填写基本信息
  - 编辑人员：修改信息、重置密码、转移小组
  - 删除人员：软删除确认

#### 2.2 客户总表页面
- **客户列表**：
  - 表格显示：星级、姓名、电话、性别、年龄、资质、归属销售员、归属小组、最新跟进时间
  - 筛选功能：按小组、销售员、星级、跟进状态筛选
  - 搜索功能：按姓名、电话搜索
  - 批量操作：批量选择、批量转移、批量导出
- **客户操作**：
  - 新增客户：弹窗表单，指定归属
  - 编辑客户：修改基本信息
  - 转移客户：单个/批量转移到其他销售员
  - 查看详情：跳转客户详情页

#### 2.3 统计报表页面
- **统计图表**：
  - 日期选择器：选择统计日期范围
  - 小组统计：柱状图显示各小组跟进人次
  - 销售员统计：表格显示销售员跟进详情
- **数据导出**：导出统计报表

#### 2.4 批量导入导出页面
- **导出功能**：
  - 筛选条件：按当前页面筛选条件导出
  - 导出选项：选择导出字段、是否包含跟进记录
  - 格式选择：Excel/CSV格式
- **导入功能**：
  - 模板下载：提供标准导入模板
  - 文件上传：支持Excel/CSV文件
  - 数据预览：上传后预览数据
  - 导入确认：显示校验结果，确认导入

### 3. Leader 组长后台
#### 3.1 组内客户列表页面
- **客户列表**：显示本组所有客户，包含状态色块
- **筛选搜索**：按销售员、星级、跟进状态筛选
- **客户操作**：新增、编辑、转移（组内）、查看详情

#### 3.2 组内统计页面
- **销售员统计**：本组销售员跟进统计
- **趋势图表**：本组跟进趋势分析

### 4. Sales 销售员后台
#### 4.1 我的客户列表页面
- **客户列表**：
  - 横向显示：状态色块、星级、姓名、电话、性别、资质、最新跟进时间
  - 状态色块：根据当天跟进次数显示颜色
  - 排序功能：按星级、最新跟进时间排序
- **快速操作**：
  - 新增客户：快速添加新客户
  - 搜索客户：按姓名、电话搜索
  - 批量跟进：选择多个客户批量添加跟进记录

### 5. 客户详情页面（通用）
#### 5.1 客户信息区域
- **基本信息**：星级、姓名、电话、性别、年龄、资质
- **归属信息**：归属销售员、归属小组
- **操作按钮**：编辑客户、转移客户（根据权限显示）

#### 5.2 跟进记录区域
- **历史跟进**：
  - 时间线展示：按时间倒序显示所有跟进记录
  - 记录详情：跟进时间、跟进内容、跟进销售员
  - 分页加载：支持分页查看历史记录
- **新增跟进**：
  - 跟进表单：跟进内容（必填）、跟进时间（可选）
  - 提交按钮：保存跟进记录
  - 实时更新：提交后立即更新列表和状态色块

---

## 六、技术架构建议

### 1. 前端技术栈
- **框架**：React 18 + TypeScript
- **UI组件库**：Ant Design 5.x
- **状态管理**：Redux Toolkit + RTK Query
- **路由**：React Router 6
- **构建工具**：Create React App + CRACO
- **样式方案**：CSS Modules + Less

### 2. 后端技术栈
- **运行环境**：Node.js 18+
- **框架**：Express.js + TypeScript
- **数据库**：MySQL 8.0
- **ORM**：TypeORM
- **认证**：JWT + bcrypt
- **文件处理**：multer + xlsx + csv-parser
- **日志**：winston
- **API文档**：Swagger/OpenAPI

### 3. 数据库设计
- **主键策略**：自增ID
- **索引设计**：
  - users表：phone（唯一索引）
  - customers表：phone（唯一索引）、owner_id、team_id
  - follow_records表：customer_id、sales_id、follow_time
- **外键约束**：保证数据完整性
- **软删除**：重要数据使用deleted_at字段

### 4. 安全设计
- **密码安全**：bcrypt加密，盐值轮数12
- **JWT配置**：7天过期，支持刷新
- **权限中间件**：接口级权限校验
- **数据验证**：joi参数验证
- **SQL注入防护**：ORM参数化查询
- **XSS防护**：输入输出过滤

---

## 七、接口设计规范

### 1. 统一响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1640995200000
}
```

### 2. 错误码定义
- 200：成功
- 400：参数错误
- 401：未认证
- 403：权限不足
- 404：资源不存在
- 500：服务器错误

### 3. 分页格式
```json
{
  "list": [],
  "pagination": {
    "current": 1,
    "pageSize": 20,
    "total": 100
  }
}
```

---

## 八、客户数据批量导入与导出功能

### 1. 批量导出功能
- **适用角色**：仅限Manager（总经理）账号操作
- **功能描述**：
  - Manager可在客户总表页面，按筛选条件（如小组、销售员、星级、跟进状态等）批量导出客户数据
  - 支持导出格式：Excel（.xlsx）、CSV（.csv）
  - 导出内容包括客户所有基础信息及历史跟进记录（可选是否导出跟进记录）
  - 导出文件字段顺序、表头清晰，便于后续数据分析或归档

### 2. 批量导入功能
- **适用角色**：仅限Manager（总经理）账号操作
- **功能描述**：
  - Manager可通过上传Excel或CSV文件，批量导入客户数据
  - 支持模板下载，明确导入字段要求（如：星级、姓名、电话、性别、年龄、资质、归属销售员、归属小组等）
  - 系统自动校验导入数据的完整性与规范性（如手机号唯一、必填项、格式正确等），校验不通过时给出详细错误提示
  - 支持导入时自动分配客户归属（可指定销售员/小组）
  - 支持批量导入历史跟进记录（可选）
  - 导入操作需有操作日志记录，便于追溯

### 3. 导入模板格式
```
客户星级 | 客户姓名 | 客户电话 | 性别 | 年龄 | 客户资质 | 归属销售员手机号 | 归属小组名称
1-5     | 必填     | 必填     | 男/女 | 数字 | 可选     | 可选           | 可选
```

### 4. 安全与权限
- 仅Manager可见和操作导入导出入口
- 导入导出操作需二次确认，防止误操作
- 导入数据需要完整性校验和重复性检查

### 5. 交互与体验
- 导入导出入口在客户总表页面显著位置
- 导入完成后，系统提示导入结果（成功/失败条数、失败原因）
- 导出支持当前筛选条件下的数据导出
- 大文件导入支持进度显示

---

## 九、非功能性需求

### 1. 性能要求
- 页面加载时间：首屏加载 < 3秒
- 接口响应时间：< 500ms
- 并发用户数：支持100+并发用户
- 数据库查询：复杂查询 < 2秒

### 2. 兼容性要求
- 浏览器：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- 设备：PC端优先，兼容平板和手机
- 分辨率：1920x1080、1366x768、移动端自适应

### 3. 可用性要求
- 系统可用性：99.5%
- 数据备份：每日自动备份
- 故障恢复：< 4小时
- 操作日志：保留6个月

### 4. 安全要求
- 数据传输：HTTPS加密
- 密码策略：8位以上，包含数字和字母
- 会话管理：7天过期，支持单点登录
- 权限控制：严格的角色权限分离

---

## 十、测试策略

### 1. 单元测试
- 前端组件测试：Jest + React Testing Library
- 后端接口测试：Jest + Supertest
- 覆盖率要求：> 80%

### 2. 集成测试
- 接口集成测试：Postman + Newman
- 数据库集成测试：测试数据库环境
- 第三方服务集成测试

### 3. 端到端测试
- 用户流程测试：Cypress
- 关键业务场景：登录、客户管理、跟进记录、权限控制
- 浏览器兼容性测试

### 4. 性能测试
- 压力测试：JMeter
- 负载测试：模拟100并发用户
- 数据库性能测试：大数据量查询

---

## 十一、部署与运维

### 1. 部署架构
- **容器化**：Docker + Docker Compose
- **反向代理**：Nginx
- **数据库**：MySQL主从复制
- **文件存储**：本地存储或云存储

### 2. 监控告警
- **应用监控**：PM2 + 日志监控
- **数据库监控**：慢查询监控
- **系统监控**：CPU、内存、磁盘使用率
- **业务监控**：关键接口响应时间

### 3. 备份策略
- **数据库备份**：每日全量备份 + 实时增量备份
- **文件备份**：定期备份上传文件
- **配置备份**：版本控制管理

---

## 十二、项目里程碑

### 阶段一：基础架构（1-2周）
- [ ] 项目初始化和环境搭建
- [ ] 数据库设计和建表
- [ ] 基础认证和权限框架
- [ ] 基础页面框架

### 阶段二：核心功能（3-4周）
- [ ] 用户管理功能
- [ ] 客户管理功能
- [ ] 跟进记录功能
- [ ] 权限控制完善

### 阶段三：高级功能（2-3周）
- [ ] 统计报表功能
- [ ] 批量导入导出功能
- [ ] 状态提示系统
- [ ] 操作日志系统

### 阶段四：测试优化（1-2周）
- [ ] 功能测试和修复
- [ ] 性能优化
- [ ] 安全测试
- [ ] 用户体验优化

### 阶段五：部署上线（1周）
- [ ] 生产环境部署
- [ ] 数据迁移
- [ ] 用户培训
- [ ] 上线监控

---

如需详细的接口文档、数据库ER图、页面原型等，可根据开发进度进一步补充完善。
