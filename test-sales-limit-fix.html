<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç»„ç­‰çº§é”€å”®å‘˜é™åˆ¶ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .success {
            color: #28a745;
            background: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            color: #17a2b8;
            background: #d1ecf1;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .team-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .member-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .member-card {
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
        }
        .role-leader {
            background: #ffc107;
            color: #212529;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }
        .role-sales {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å°ç»„ç­‰çº§é”€å”®å‘˜é™åˆ¶ä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¿®å¤åçš„å°ç»„ç­‰çº§é™åˆ¶é€»è¾‘ï¼šå°ç»„ç­‰çº§é™åˆ¶åªé’ˆå¯¹é”€å”®å‘˜æ•°é‡ï¼Œç»„é•¿ä¸è®¡å…¥é™åˆ¶ã€‚</p>
    </div>

    <div class="container">
        <h2>ğŸ“Š å½“å‰å›¢é˜ŸçŠ¶æ€</h2>
        <button class="test-button" onclick="loadTeamStatus()">åˆ·æ–°å›¢é˜ŸçŠ¶æ€</button>
        <div id="teamStatus"></div>
    </div>

    <div class="container">
        <h2>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h2>
        
        <div class="test-section">
            <h3>æµ‹è¯•1: å‘é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿæ·»åŠ é”€å”®å‘˜ï¼ˆåº”è¯¥å¤±è´¥ï¼‰</h3>
            <p>é€‰æ‹©ä¸€ä¸ªé”€å”®å‘˜æ•°é‡æ¥è¿‘é™åˆ¶çš„å›¢é˜Ÿï¼Œå°è¯•æ·»åŠ æ–°çš„é”€å”®å‘˜</p>
            <button class="test-button" onclick="testAddSalesToFullTeam()">æ‰§è¡Œæµ‹è¯•</button>
            <div id="test1Result"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•2: å‘é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿæ·»åŠ ç»„é•¿ï¼ˆåº”è¯¥æˆåŠŸï¼‰</h3>
            <p>å‘åŒä¸€ä¸ªå›¢é˜Ÿæ·»åŠ ç»„é•¿ï¼Œåº”è¯¥æˆåŠŸï¼ˆç»„é•¿ä¸å—é”€å”®å‘˜æ•°é‡é™åˆ¶ï¼‰</p>
            <button class="test-button" onclick="testAddLeaderToFullTeam()">æ‰§è¡Œæµ‹è¯•</button>
            <div id="test2Result"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•3: åˆ›å»ºé”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿï¼ˆåº”è¯¥å¤±è´¥ï¼‰</h3>
            <p>å°è¯•åˆ›å»ºæ–°çš„é”€å”®å‘˜ç”¨æˆ·å¹¶åˆ†é…åˆ°é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿ</p>
            <button class="test-button" onclick="testCreateSalesInFullTeam()">æ‰§è¡Œæµ‹è¯•</button>
            <div id="test3Result"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•4: æ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿï¼ˆåº”è¯¥å¤±è´¥ï¼‰</h3>
            <p>å°è¯•æ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°é”€å”®å‘˜æ•°é‡å·²æ»¡çš„å›¢é˜Ÿ</p>
            <button class="test-button" onclick="testBatchTransferToFullTeam()">æ‰§è¡Œæµ‹è¯•</button>
            <div id="test4Result"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•5: éªŒè¯å›¢é˜Ÿæˆå‘˜æ•°é‡ç»Ÿè®¡</h3>
            <p>éªŒè¯å›¢é˜Ÿçš„member_countå­—æ®µæ˜¯å¦æ­£ç¡®è®°å½•æ€»æˆå‘˜æ•°</p>
            <button class="test-button" onclick="testMemberCountAccuracy()">æ‰§è¡Œæµ‹è¯•</button>
            <div id="test5Result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let authToken = '';

        // ç™»å½•è·å–token
        async function login() {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: '13800000001',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                if (data.code === 200) {
                    authToken = data.data.token;
                    return true;
                } else {
                    console.error('ç™»å½•å¤±è´¥:', data.message);
                    return false;
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                return false;
            }
        }

        // APIè¯·æ±‚å°è£…
        async function apiRequest(url, options = {}) {
            if (!authToken) {
                const loginSuccess = await login();
                if (!loginSuccess) {
                    throw new Error('ç™»å½•å¤±è´¥');
                }
            }

            const response = await fetch(`${API_BASE}${url}`, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...options.headers
                }
            });

            return await response.json();
        }

        // åŠ è½½å›¢é˜ŸçŠ¶æ€
        async function loadTeamStatus() {
            try {
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                let html = '<div class="team-info">';
                
                if (teamsData.code === 200 && usersData.code === 200) {
                    const teams = teamsData.data.list;
                    const users = usersData.data.list;

                    html += '<h4>å›¢é˜Ÿè¯¦ç»†ä¿¡æ¯:</h4>';
                    
                    for (const team of teams) {
                        const teamMembers = users.filter(user => user.teamId === team.id);
                        const salesMembers = teamMembers.filter(user => user.role === 'sales');
                        const leaderMembers = teamMembers.filter(user => user.role === 'leader');

                        const salesStatus = salesMembers.length >= team.maxMembers ? 'ğŸ”´ å·²æ»¡' : 
                                          salesMembers.length === team.maxMembers - 1 ? 'ğŸŸ¡ æ¥è¿‘æ»¡' : 'ğŸŸ¢ æ­£å¸¸';

                        html += `
                            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
                                <h5>${team.name} (ç­‰çº§: ${team.level})</h5>
                                <p><strong>é”€å”®å‘˜é™åˆ¶:</strong> ${salesMembers.length}/${team.maxMembers} ${salesStatus}</p>
                                <p><strong>ç»„é•¿æ•°é‡:</strong> ${leaderMembers.length}/1</p>
                                <p><strong>æ€»æˆå‘˜æ•°:</strong> ${teamMembers.length} (è®°å½•: ${team.memberCount})</p>
                                
                                <div class="member-list">
                        `;

                        teamMembers.forEach(member => {
                            const roleClass = member.role === 'leader' ? 'role-leader' : 'role-sales';
                            const roleText = member.role === 'leader' ? 'ç»„é•¿' : 'é”€å”®å‘˜';
                            html += `
                                <div class="member-card">
                                    <strong>${member.name}</strong><br>
                                    <span class="${roleClass}">${roleText}</span><br>
                                    <small>${member.phone}</small>
                                </div>
                            `;
                        });

                        html += `
                                </div>
                            </div>
                        `;
                    }
                } else {
                    html += '<div class="error">è·å–å›¢é˜Ÿæ•°æ®å¤±è´¥</div>';
                }

                html += '</div>';
                document.getElementById('teamStatus').innerHTML = html;

            } catch (error) {
                document.getElementById('teamStatus').innerHTML = 
                    `<div class="error">åŠ è½½å›¢é˜ŸçŠ¶æ€å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•1: å‘é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿæ·»åŠ é”€å”®å‘˜
        async function testAddSalesToFullTeam() {
            const resultDiv = document.getElementById('test1Result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>';

            try {
                // å…ˆè·å–å›¢é˜Ÿå’Œç”¨æˆ·æ•°æ®
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                if (teamsData.code !== 200 || usersData.code !== 200) {
                    throw new Error('è·å–æ•°æ®å¤±è´¥');
                }

                const teams = teamsData.data.list;
                const users = usersData.data.list;

                // æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æµ‹è¯•çš„å›¢é˜Ÿï¼ˆé”€å”®å‘˜æ•°é‡æ¥è¿‘é™åˆ¶ï¼‰
                let targetTeam = null;
                let unassignedSales = users.find(user => user.role === 'sales' && !user.teamId);

                for (const team of teams) {
                    const teamSales = users.filter(user => user.teamId === team.id && user.role === 'sales');
                    if (teamSales.length < team.maxMembers) {
                        // å…ˆå¡«æ»¡è¿™ä¸ªå›¢é˜Ÿçš„é”€å”®å‘˜
                        targetTeam = team;
                        break;
                    }
                }

                if (!targetTeam || !unassignedSales) {
                    resultDiv.innerHTML = '<div class="info">æ²¡æœ‰åˆé€‚çš„æµ‹è¯•æ¡ä»¶ï¼ˆéœ€è¦æœªæ»¡çš„å›¢é˜Ÿå’Œæœªåˆ†é…çš„é”€å”®å‘˜ï¼‰</div>';
                    return;
                }

                // å…ˆå°è¯•å¡«æ»¡å›¢é˜Ÿ
                const response = await apiRequest(`/teams/${targetTeam.id}/members`, {
                    method: 'POST',
                    body: JSON.stringify({ userId: unassignedSales.id })
                });

                if (response.code === 200) {
                    resultDiv.innerHTML = '<div class="success">âœ… æµ‹è¯•å‡†å¤‡ï¼šæˆåŠŸæ·»åŠ é”€å”®å‘˜åˆ°å›¢é˜Ÿ</div>';
                    
                    // ç°åœ¨å°è¯•å†æ·»åŠ ä¸€ä¸ªé”€å”®å‘˜ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
                    const anotherSales = users.find(user => 
                        user.role === 'sales' && 
                        !user.teamId && 
                        user.id !== unassignedSales.id
                    );

                    if (anotherSales) {
                        const failResponse = await apiRequest(`/teams/${targetTeam.id}/members`, {
                            method: 'POST',
                            body: JSON.stringify({ userId: anotherSales.id })
                        });

                        if (failResponse.code !== 200) {
                            resultDiv.innerHTML += `<div class="success">âœ… æµ‹è¯•é€šè¿‡ï¼šå‘é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿæ·»åŠ é”€å”®å‘˜è¢«æ­£ç¡®æ‹’ç»<br>é”™è¯¯ä¿¡æ¯: ${failResponse.message}</div>`;
                        } else {
                            resultDiv.innerHTML += '<div class="error">âŒ æµ‹è¯•å¤±è´¥ï¼šåº”è¯¥æ‹’ç»æ·»åŠ é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ</div>';
                        }
                    } else {
                        resultDiv.innerHTML += '<div class="info">æ²¡æœ‰æ›´å¤šæœªåˆ†é…çš„é”€å”®å‘˜è¿›è¡Œæµ‹è¯•</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error">æµ‹è¯•å‡†å¤‡å¤±è´¥: ${response.message}</div>`;
                }

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•2: å‘é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿæ·»åŠ ç»„é•¿
        async function testAddLeaderToFullTeam() {
            const resultDiv = document.getElementById('test2Result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>';

            try {
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                if (teamsData.code !== 200 || usersData.code !== 200) {
                    throw new Error('è·å–æ•°æ®å¤±è´¥');
                }

                const teams = teamsData.data.list;
                const users = usersData.data.list;

                // æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰ç»„é•¿çš„å›¢é˜Ÿ
                let targetTeam = null;
                let unassignedLeader = users.find(user => user.role === 'leader' && !user.teamId);

                for (const team of teams) {
                    const teamLeaders = users.filter(user => user.teamId === team.id && user.role === 'leader');
                    if (teamLeaders.length === 0) {
                        targetTeam = team;
                        break;
                    }
                }

                if (!targetTeam || !unassignedLeader) {
                    resultDiv.innerHTML = '<div class="info">æ²¡æœ‰åˆé€‚çš„æµ‹è¯•æ¡ä»¶ï¼ˆéœ€è¦æ²¡æœ‰ç»„é•¿çš„å›¢é˜Ÿå’Œæœªåˆ†é…çš„ç»„é•¿ï¼‰</div>';
                    return;
                }

                // å°è¯•æ·»åŠ ç»„é•¿åˆ°å›¢é˜Ÿ
                const response = await apiRequest(`/teams/${targetTeam.id}/members`, {
                    method: 'POST',
                    body: JSON.stringify({ userId: unassignedLeader.id })
                });

                if (response.code === 200) {
                    resultDiv.innerHTML = '<div class="success">âœ… æµ‹è¯•é€šè¿‡ï¼šæˆåŠŸå‘å›¢é˜Ÿæ·»åŠ ç»„é•¿ï¼ˆä¸å—é”€å”®å‘˜æ•°é‡é™åˆ¶å½±å“ï¼‰</div>';
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥ï¼šæ·»åŠ ç»„é•¿è¢«æ‹’ç» - ${response.message}</div>`;
                }

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•3: åˆ›å»ºé”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ
        async function testCreateSalesInFullTeam() {
            const resultDiv = document.getElementById('test3Result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>';

            try {
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                if (teamsData.code !== 200 || usersData.code !== 200) {
                    throw new Error('è·å–æ•°æ®å¤±è´¥');
                }

                const teams = teamsData.data.list;
                const users = usersData.data.list;

                // æ‰¾åˆ°ä¸€ä¸ªé”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿ
                let fullTeam = null;
                for (const team of teams) {
                    const teamSales = users.filter(user => user.teamId === team.id && user.role === 'sales');
                    if (teamSales.length >= team.maxMembers) {
                        fullTeam = team;
                        break;
                    }
                }

                if (!fullTeam) {
                    resultDiv.innerHTML = '<div class="info">æ²¡æœ‰é”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿè¿›è¡Œæµ‹è¯•</div>';
                    return;
                }

                // å°è¯•åˆ›å»ºæ–°çš„é”€å”®å‘˜ç”¨æˆ·å¹¶åˆ†é…åˆ°å·²æ»¡å›¢é˜Ÿ
                const timestamp = Date.now();
                const response = await apiRequest('/users', {
                    method: 'POST',
                    body: JSON.stringify({
                        phone: `138${timestamp.toString().slice(-8)}`,
                        name: `æµ‹è¯•é”€å”®å‘˜${timestamp}`,
                        role: 'sales',
                        teamId: fullTeam.id,
                        joinDate: '2024-01-01'
                    })
                });

                if (response.code !== 200) {
                    resultDiv.innerHTML = `<div class="success">âœ… æµ‹è¯•é€šè¿‡ï¼šåˆ›å»ºé”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿè¢«æ­£ç¡®æ‹’ç»<br>é”™è¯¯ä¿¡æ¯: ${response.message}</div>`;
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ æµ‹è¯•å¤±è´¥ï¼šåº”è¯¥æ‹’ç»åˆ›å»ºé”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ</div>';
                }

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•4: æ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ
        async function testBatchTransferToFullTeam() {
            const resultDiv = document.getElementById('test4Result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>';

            try {
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                if (teamsData.code !== 200 || usersData.code !== 200) {
                    throw new Error('è·å–æ•°æ®å¤±è´¥');
                }

                const teams = teamsData.data.list;
                const users = usersData.data.list;

                // æ‰¾åˆ°ä¸€ä¸ªé”€å”®å‘˜å·²æ»¡çš„å›¢é˜Ÿ
                let fullTeam = null;
                for (const team of teams) {
                    const teamSales = users.filter(user => user.teamId === team.id && user.role === 'sales');
                    if (teamSales.length >= team.maxMembers) {
                        fullTeam = team;
                        break;
                    }
                }

                // æ‰¾åˆ°ä¸€äº›å…¶ä»–å›¢é˜Ÿçš„é”€å”®å‘˜
                const otherSales = users.filter(user => 
                    user.role === 'sales' && 
                    user.teamId && 
                    user.teamId !== fullTeam?.id
                ).slice(0, 2);

                if (!fullTeam || otherSales.length === 0) {
                    resultDiv.innerHTML = '<div class="info">æ²¡æœ‰åˆé€‚çš„æµ‹è¯•æ¡ä»¶</div>';
                    return;
                }

                // å°è¯•æ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ
                const response = await apiRequest('/users/batch-update-team', {
                    method: 'POST',
                    body: JSON.stringify({
                        userIds: otherSales.map(user => user.id),
                        teamId: fullTeam.id
                    })
                });

                if (response.code !== 200) {
                    resultDiv.innerHTML = `<div class="success">âœ… æµ‹è¯•é€šè¿‡ï¼šæ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿè¢«æ­£ç¡®æ‹’ç»<br>é”™è¯¯ä¿¡æ¯: ${response.message}</div>`;
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ æµ‹è¯•å¤±è´¥ï¼šåº”è¯¥æ‹’ç»æ‰¹é‡è½¬ç§»é”€å”®å‘˜åˆ°å·²æ»¡å›¢é˜Ÿ</div>';
                }

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•5: éªŒè¯å›¢é˜Ÿæˆå‘˜æ•°é‡ç»Ÿè®¡
        async function testMemberCountAccuracy() {
            const resultDiv = document.getElementById('test5Result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>';

            try {
                const teamsData = await apiRequest('/teams');
                const usersData = await apiRequest('/users');

                if (teamsData.code !== 200 || usersData.code !== 200) {
                    throw new Error('è·å–æ•°æ®å¤±è´¥');
                }

                const teams = teamsData.data.list;
                const users = usersData.data.list;

                let html = '<div class="success">âœ… å›¢é˜Ÿæˆå‘˜æ•°é‡ç»Ÿè®¡éªŒè¯:</div>';
                let allCorrect = true;

                for (const team of teams) {
                    const actualMembers = users.filter(user => user.teamId === team.id);
                    const actualCount = actualMembers.length;
                    const recordedCount = team.memberCount;

                    const salesCount = actualMembers.filter(user => user.role === 'sales').length;
                    const leaderCount = actualMembers.filter(user => user.role === 'leader').length;

                    const isCorrect = actualCount === recordedCount;
                    if (!isCorrect) allCorrect = false;

                    const status = isCorrect ? 'âœ…' : 'âŒ';
                    html += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <strong>${team.name}</strong> ${status}<br>
                            å®é™…æˆå‘˜æ•°: ${actualCount} (${salesCount}é”€å”®å‘˜ + ${leaderCount}ç»„é•¿)<br>
                            è®°å½•æˆå‘˜æ•°: ${recordedCount}<br>
                            é”€å”®å‘˜é™åˆ¶: ${salesCount}/${team.maxMembers}
                        </div>
                    `;
                }

                if (allCorrect) {
                    html += '<div class="success">ğŸ‰ æ‰€æœ‰å›¢é˜Ÿçš„æˆå‘˜æ•°é‡ç»Ÿè®¡éƒ½æ­£ç¡®ï¼</div>';
                } else {
                    html += '<div class="error">âš ï¸ å‘ç°æˆå‘˜æ•°é‡ç»Ÿè®¡ä¸ä¸€è‡´çš„å›¢é˜Ÿ</div>';
                }

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½å›¢é˜ŸçŠ¶æ€
        window.onload = function() {
            loadTeamStatus();
        };
    </script>
</body>
</html> 