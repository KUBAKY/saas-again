<!-- è¯¾ç¨‹è¯¦æƒ…é¡µé¢ -->
<view class="page-container">
  <!-- è¯¾ç¨‹å°é¢ -->
  <view class="course-header">
    <image 
      class="course-cover" 
      src="{{courseDetail.coverImage || '/images/course-cover.jpg'}}"
      mode="aspectFill"
    />
    <view class="course-info-overlay">
      <view class="course-title">{{courseDetail.name}}</view>
      <view class="course-meta">
        <text class="level-tag level-{{courseDetail.level}}">{{courseDetail.levelText}}</text>
        <text class="category">{{courseDetail.category}}</text>
        <text class="duration">{{courseDetail.duration}}åˆ†é’Ÿ</text>
      </view>
      <view class="course-stats">
        <view class="stat-item">
          <text class="stat-number">{{courseDetail.rating}}</text>
          <text class="stat-label">è¯„åˆ†</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{courseDetail.currentParticipants}}/{{courseDetail.maxParticipants}}</text>
          <text class="stat-label">äººæ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{courseDetail.totalSessions}}</text>
          <text class="stat-label">æ€»è¯¾æ—¶</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¾ç¨‹æè¿° -->
  <view class="section">
    <view class="section-title">è¯¾ç¨‹ä»‹ç»</view>
    <view class="course-description">{{courseDetail.description}}</view>
    
    <!-- æ ‡ç­¾ -->
    <view class="tags-container" wx:if="{{courseDetail.tags.length}}">
      <view 
        class="tag-item"
        wx:for="{{courseDetail.tags}}" 
        wx:key="*this"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- æ•™ç»ƒä¿¡æ¯ -->
  <view class="section">
    <view class="section-title">
      <text>æˆè¯¾æ•™ç»ƒ</text>
      <text class="view-more" bindtap="viewCoachDetail">æŸ¥çœ‹è¯¦æƒ… ></text>
    </view>
    <view class="coach-card" bindtap="viewCoachDetail">
      <image class="coach-avatar" src="{{coachInfo.avatar}}" />
      <view class="coach-info">
        <view class="coach-name">{{coachInfo.name}}</view>
        <view class="coach-specialties">
          <text wx:for="{{coachInfo.specialties}}" wx:key="*this" class="specialty">
            {{item}}{{index < coachInfo.specialties.length - 1 ? ' Â· ' : ''}}
          </text>
        </view>
        <view class="coach-stats">
          <text class="experience">{{coachInfo.experience}}å¹´ç»éªŒ</text>
          <text class="rating">â­ {{coachInfo.rating}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¾ç¨‹æ•ˆæœ -->
  <view class="section" wx:if="{{courseDetail.benefits.length}}">
    <view class="section-title">è¯¾ç¨‹æ•ˆæœ</view>
    <view class="benefits-list">
      <view 
        class="benefit-item"
        wx:for="{{courseDetail.benefits}}" 
        wx:key="index"
      >
        <text class="benefit-icon">âœ“</text>
        <text class="benefit-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- é€‚ç”¨äººç¾¤ä¸è¦æ±‚ -->
  <view class="section" wx:if="{{courseDetail.requirements.length}}">
    <view class="section-title">é€‚ç”¨äººç¾¤</view>
    <view class="requirements-list">
      <view 
        class="requirement-item"
        wx:for="{{courseDetail.requirements}}" 
        wx:key="index"
      >
        <text class="requirement-dot">â€¢</text>
        <text class="requirement-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- æ‰€éœ€å™¨æ -->
  <view class="section" wx:if="{{courseDetail.equipment.length}}">
    <view class="section-title">æ‰€éœ€å™¨æ</view>
    <view class="equipment-list">
      <text 
        class="equipment-item"
        wx:for="{{courseDetail.equipment}}" 
        wx:key="*this"
      >
        {{item}}{{index < courseDetail.equipment.length - 1 ? 'ã€' : ''}}
      </text>
    </view>
  </view>

  <!-- å¯é¢„çº¦æ—¶é—´æ®µ -->
  <view class="section">
    <view class="section-title">å¯é¢„çº¦æ—¶é—´</view>
    <scroll-view class="time-slots-container" scroll-x>
      <view 
        class="time-slot-item {{selectedTimeSlot && selectedTimeSlot.id === item.id ? 'selected' : ''}} {{!item.available ? 'disabled' : ''}}"
        wx:for="{{availableTimeSlots}}" 
        wx:key="id"
        bindtap="selectTimeSlot"
        data-slot="{{item}}"
      >
        <view class="slot-date">{{item.dateText}}</view>
        <view class="slot-time">{{item.startTime}}-{{item.endTime}}</view>
        <view class="slot-participants">{{item.currentParticipants}}/{{item.maxParticipants}}äºº</view>
        <view class="slot-status" wx:if="{{!item.available}}">å·²æ»¡</view>
      </view>
    </scroll-view>
  </view>

  <!-- å­¦å‘˜è¯„ä»· -->
  <view class="section">
    <view class="section-title">
      <text>å­¦å‘˜è¯„ä»· ({{reviews.length}})</text>
      <text class="add-review" bindtap="showReviewDialog">å†™è¯„ä»·</text>
    </view>
    <view class="reviews-list" wx:if="{{reviews.length}}">
      <view 
        class="review-item"
        wx:for="{{reviews}}" 
        wx:key="id"
      >
        <view class="review-header">
          <image class="member-avatar" src="{{item.memberAvatar}}" />
          <view class="review-info">
            <view class="member-name">{{item.memberName}}</view>
            <view class="review-meta">
              <van-rate value="{{item.rating}}" readonly size="12" />
              <text class="review-date">{{item.date}}</text>
            </view>
          </view>
        </view>
        <view class="review-content">{{item.comment}}</view>
        <view class="review-actions">
          <text 
            class="like-btn" 
            bindtap="likeReview" 
            data-id="{{item.id}}"
          >
            ğŸ‘ {{item.helpful}}
          </text>
        </view>
      </view>
    </view>
    <view class="no-reviews" wx:else>
      <text>æš‚æ— è¯„ä»·ï¼Œæ¥å†™ç¬¬ä¸€æ¡è¯„ä»·å§~</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-actions">
  <view class="price-section">
    <view class="price-info">
      <text class="current-price">Â¥{{courseDetail.price}}</text>
      <text class="original-price" wx:if="{{courseDetail.originalPrice > courseDetail.price}}">Â¥{{courseDetail.originalPrice}}</text>
    </view>
  </view>
  
  <view class="action-buttons">
    <button 
      class="contact-btn"
      bindtap="contactService"
    >
      å’¨è¯¢
    </button>
    <button 
      class="book-btn {{isBooked ? 'booked' : ''}}"
      bindtap="{{isBooked ? 'cancelBooking' : 'bookCourse'}}"
    >
      {{isBooked ? 'å–æ¶ˆé¢„çº¦' : 'ç«‹å³é¢„çº¦'}}
    </button>
  </view>
</view>

<!-- é¢„çº¦ç¡®è®¤å¼¹çª— -->
<van-popup 
  show="{{showBookingPopup}}" 
  position="bottom" 
  round
  bind:close="closeBookingPopup"
>
  <view class="booking-popup">
    <view class="popup-title">ç¡®è®¤é¢„çº¦</view>
    <view class="booking-info" wx:if="{{selectedTimeSlot}}">
      <view class="info-item">
        <text class="label">è¯¾ç¨‹ï¼š</text>
        <text class="value">{{courseDetail.name}}</text>
      </view>
      <view class="info-item">
        <text class="label">æ—¶é—´ï¼š</text>
        <text class="value">{{selectedTimeSlot.dateText}} {{selectedTimeSlot.startTime}}-{{selectedTimeSlot.endTime}}</text>
      </view>
      <view class="info-item">
        <text class="label">åœ°ç‚¹ï¼š</text>
        <text class="value">{{courseDetail.location}}</text>
      </view>
      <view class="info-item">
        <text class="label">è´¹ç”¨ï¼š</text>
        <text class="value price">Â¥{{courseDetail.price}}</text>
      </view>
    </view>
    <view class="popup-actions">
      <button class="cancel-btn" bindtap="closeBookingPopup">å–æ¶ˆ</button>
      <button 
        class="confirm-btn"
        loading="{{bookingLoading}}"
        bindtap="confirmBooking"
      >
        ç¡®è®¤é¢„çº¦
      </button>
    </view>
  </view>
</van-popup>

<!-- è¯„ä»·å¼¹çª— -->
<van-popup 
  show="{{showReviewPopup}}" 
  position="center" 
  round
  bind:close="closeReviewPopup"
>
  <view class="review-popup">
    <view class="popup-title">è¯¾ç¨‹è¯„ä»·</view>
    <view class="rating-section">
      <text class="rating-label">è¯¾ç¨‹è¯„åˆ†</text>
      <van-rate 
        value="{{newReview.rating}}" 
        bind:change="onRatingChange"
        allow-half
        size="24"
      />
    </view>
    <view class="comment-section">
      <textarea 
        class="comment-input"
        placeholder="åˆ†äº«æ‚¨çš„ä¸Šè¯¾æ„Ÿå—..."
        value="{{newReview.comment}}"
        bindinput="onCommentInput"
        maxlength="200"
      />
    </view>
    <view class="popup-actions">
      <button class="cancel-btn" bindtap="closeReviewPopup">å–æ¶ˆ</button>
      <button class="submit-btn" bindtap="submitReview">æäº¤è¯„ä»·</button>
    </view>
  </view>
</van-popup>

<!-- Vantç»„ä»¶å¯¼å…¥ -->
<van-rate />
<van-popup />