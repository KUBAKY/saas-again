<!-- èº«ä½“æ•°æ®è®°å½•é¡µé¢ -->
<view class="page-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="profile-card">
    <view class="profile-header">
      <image class="profile-avatar" src="{{userProfile.avatar}}" />
      <view class="profile-info">
        <view class="profile-name">{{userProfile.name}}</view>
        <view class="profile-details">
          <text>{{userProfile.age}}å²</text>
          <text class="separator">Â·</text>
          <text>{{userProfile.height}}cm</text>
        </view>
      </view>
      <view class="target-section" bindtap="showTargetDialog">
        <view class="target-label">ç›®æ ‡ä½“é‡</view>
        <view class="target-value">{{userProfile.targetWeight}}kg</view>
        <van-icon name="edit" size="16" />
      </view>
    </view>
  </view>

  <!-- å½“å‰æ•°æ®æ¦‚è§ˆ -->
  <view class="metrics-overview">
    <view class="overview-header">
      <text class="section-title">å½“å‰æ•°æ®</text>
      <text class="last-updated" wx:if="{{currentMetrics.lastUpdated}}">
        æ›´æ–°äº {{currentMetrics.lastUpdated}}
      </text>
    </view>
    
    <view class="metrics-grid">
      <view class="metric-item">
        <view class="metric-value">{{currentMetrics.weight || '-'}}</view>
        <view class="metric-label">ä½“é‡ (kg)</view>
      </view>
      <view class="metric-item">
        <view class="metric-value">{{currentMetrics.bodyFat || '-'}}</view>
        <view class="metric-label">ä½“è„‚ç‡ (%)</view>
      </view>
      <view class="metric-item">
        <view class="metric-value">{{currentMetrics.muscleMass || '-'}}</view>
        <view class="metric-label">è‚Œè‚‰é‡ (kg)</view>
      </view>
      <view class="metric-item">
        <view class="metric-value" style="color: {{getBMIStatus(currentMetrics.bmi).color}}">
          {{currentMetrics.bmi || '-'}}
        </view>
        <view class="metric-label">
          BMI 
          <text class="bmi-status" style="color: {{getBMIStatus(currentMetrics.bmi).color}}">
            {{getBMIStatus(currentMetrics.bmi).text}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®è¶‹åŠ¿å›¾è¡¨ -->
  <view class="chart-section">
    <view class="chart-tabs">
      <view 
        class="chart-tab {{activeTab === 0 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="0"
      >
        ä½“é‡
      </view>
      <view 
        class="chart-tab {{activeTab === 1 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="1"
      >
        ä½“è„‚ç‡
      </view>
      <view 
        class="chart-tab {{activeTab === 2 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="2"
      >
        è‚Œè‚‰é‡
      </view>
    </view>
    
    <!-- å›¾è¡¨å ä½ç¬¦ -->
    <view class="chart-placeholder">
      <view class="chart-icon">ğŸ“Š</view>
      <view class="chart-text">
        {{activeTab === 0 ? 'ä½“é‡' : activeTab === 1 ? 'ä½“è„‚ç‡' : 'è‚Œè‚‰é‡'}}è¶‹åŠ¿å›¾
      </view>
      <view class="chart-desc">è®°å½•æ›´å¤šæ•°æ®ä»¥æŸ¥çœ‹è¯¦ç»†è¶‹åŠ¿</view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">å†å²è®°å½•</text>
      <button class="add-btn" bindtap="showAddDialog">
        <van-icon name="plus" size="16" />
        è®°å½•æ•°æ®
      </button>
    </view>

    <view class="history-list" wx:if="{{metricsHistory.length}}">
      <view 
        class="history-item"
        wx:for="{{metricsHistory}}" 
        wx:key="id"
      >
        <view class="history-date">{{item.date}}</view>
        <view class="history-data">
          <view class="data-row">
            <text class="data-label">ä½“é‡</text>
            <text class="data-value">{{item.weight}}kg</text>
          </view>
          <view class="data-row">
            <text class="data-label">ä½“è„‚ç‡</text>
            <text class="data-value">{{item.bodyFat}}%</text>
          </view>
          <view class="data-row">
            <text class="data-label">è‚Œè‚‰é‡</text>
            <text class="data-value">{{item.muscleMass}}kg</text>
          </view>
          <view class="data-row">
            <text class="data-label">BMI</text>
            <text class="data-value">{{item.bmi}}</text>
          </view>
        </view>
        <view class="history-note" wx:if="{{item.note}}">
          ğŸ’­ {{item.note}}
        </view>
        <view class="history-actions">
          <text 
            class="delete-btn" 
            bindtap="deleteRecord"
            data-id="{{item.id}}"
          >
            åˆ é™¤
          </text>
        </view>
      </view>
    </view>

    <view class="empty-history" wx:else>
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— è®°å½•</view>
      <view class="empty-desc">å¼€å§‹è®°å½•ä½ çš„èº«ä½“æ•°æ®å§</view>
    </view>
  </view>

  <!-- æˆå°±ç³»ç»Ÿ -->
  <view class="achievements-section" wx:if="{{achievements.length}}">
    <view class="section-title">æˆ‘çš„æˆå°±</view>
    <scroll-view class="achievements-scroll" scroll-x>
      <view 
        class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
        wx:for="{{achievements}}" 
        wx:key="id"
      >
        <view class="achievement-icon">{{item.icon}}</view>
        <view class="achievement-title">{{item.title}}</view>
        <view class="achievement-desc">{{item.description}}</view>
        <view class="achievement-date" wx:if="{{item.unlocked && item.date}}">
          {{item.date}}
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- æ·»åŠ æ•°æ®å¼¹çª— -->
<van-popup 
  show="{{showAddDialog}}" 
  position="bottom" 
  round
  bind:close="closeAddDialog"
>
  <view class="add-dialog">
    <view class="dialog-header">
      <text class="dialog-title">è®°å½•èº«ä½“æ•°æ®</text>
    </view>
    
    <view class="dialog-content">
      <view class="input-group">
        <text class="input-label">æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{newMetrics.date}}" 
          bindchange="onDateChange"
        >
          <view class="date-picker">
            {{newMetrics.date || 'é€‰æ‹©æ—¥æœŸ'}}
            <van-icon name="arrow-down" size="16" />
          </view>
        </picker>
      </view>

      <view class="input-group">
        <text class="input-label">ä½“é‡ (kg)</text>
        <input 
          class="metric-input"
          type="digit"
          placeholder="è¯·è¾“å…¥ä½“é‡"
          value="{{newMetrics.weight}}"
          data-field="weight"
          bindinput="onInputChange"
        />
      </view>

      <view class="input-group">
        <text class="input-label">ä½“è„‚ç‡ (%)</text>
        <input 
          class="metric-input"
          type="digit"
          placeholder="è¯·è¾“å…¥ä½“è„‚ç‡"
          value="{{newMetrics.bodyFat}}"
          data-field="bodyFat"
          bindinput="onInputChange"
        />
      </view>

      <view class="input-group">
        <text class="input-label">è‚Œè‚‰é‡ (kg)</text>
        <input 
          class="metric-input"
          type="digit"
          placeholder="è¯·è¾“å…¥è‚Œè‚‰é‡"
          value="{{newMetrics.muscleMass}}"
          data-field="muscleMass"
          bindinput="onInputChange"
        />
      </view>

      <view class="input-group">
        <text class="input-label">å¤‡æ³¨ (å¯é€‰)</text>
        <textarea 
          class="note-input"
          placeholder="è®°å½•ä»Šå¤©çš„æ„Ÿå—æˆ–è®­ç»ƒæƒ…å†µ..."
          value="{{newMetrics.note}}"
          data-field="note"
          bindinput="onInputChange"
          maxlength="100"
        />
      </view>
    </view>

    <view class="dialog-actions">
      <button class="cancel-btn" bindtap="closeAddDialog">å–æ¶ˆ</button>
      <button class="submit-btn" bindtap="submitMetrics">ä¿å­˜</button>
    </view>
  </view>
</van-popup>

<!-- ç›®æ ‡ä½“é‡è®¾ç½®å¼¹çª— -->
<van-dialog
  show="{{showTargetDialog}}"
  title="è®¾ç½®ç›®æ ‡ä½“é‡"
  show-cancel-button
  bind:confirm="saveTargetWeight"
  bind:cancel="closeTargetDialog"
  confirm-button-text="ä¿å­˜"
  cancel-button-text="å–æ¶ˆ"
>
  <view class="target-input-container">
    <input 
      class="target-input"
      type="digit"
      placeholder="è¯·è¾“å…¥ç›®æ ‡ä½“é‡"
      value="{{targetWeight}}"
      bindinput="onTargetWeightInput"
    />
    <text class="target-unit">kg</text>
  </view>
</van-dialog>

<!-- æˆå°±è§£é”å¼¹çª— -->
<van-popup 
  show="{{showAchievementPopup}}" 
  position="center" 
  round
  bind:close="closeAchievementPopup"
>
  <view class="achievement-popup" wx:if="{{selectedAchievement}}">
    <view class="achievement-popup-icon">{{selectedAchievement.icon}}</view>
    <view class="achievement-popup-title">{{selectedAchievement.title}}</view>
    <view class="achievement-popup-desc">{{selectedAchievement.description}}</view>
    <button class="achievement-popup-btn" bindtap="closeAchievementPopup">
      å¤ªæ£’äº†ï¼
    </button>
  </view>
</van-popup>

<!-- Vantç»„ä»¶ -->
<van-icon />
<van-popup />
<van-dialog />